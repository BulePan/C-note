# 信号
## 信号概念
信号时软件中断，它提供了一种处理异步事件的方法。
信号名被定义为正整数常量(信号编号)。

**信号的产生条件**
1. 当用户按下某些终端按键，引发终端产生信号。在终端上按Delete键(某些系统中为Ctrl+C键)通常产生中断信号(SIGINT).这是停止一个已失去控制程序的方法。
2. 硬件异常产生信号。除数为0、无效的内存引用等。
3. 进程调用`kill`函数可以将任意信号发送给另一个进程或进程组。对此有所限制：接收信号进程和发送信号进程的所有者必须相同，或者发送信号进程的所有者必须是超级用户。
4. 用户可以用kill命令(上面那个kill是函数调用，这个kill是命令)将信号发送给其他进程。此命令只是kill函数的接口。常用此命令终止一个失控的后台进程。
5. 当检测到某种软件条件已经发生，并应将其通知有关进程时也产生信号。这里指的不是硬件条件(如除以0)，而是软件条件。

**信号的处理方式**
1. 忽略此信号。大多数信号都可使用这种方式进行处理，但是有两种信号却不能被忽略。它们是SIGKILL和SIGSTOP。**这两个信号不能被忽略的原因**：他们向内核和超级用户提供了使进程终止或停止的可靠方法。另外如果忽略某些有硬件异常产生的信号(如非法内存引用或除以0)，则进程的运行行为是未定义的。
2. 捕捉信号。为了做到这一点，要通知内核在某中信号产生时，调用一个用户函数。在用户函数中，可执行用户希望对这种事件进行的处理。**不能捕捉SIGKILL和SIGSTOP信号**。
3. 执行系统默认动作。对于大多数信号系统默认动作时终止该进程。

## signal函数
```
#include <signal.h>
typedef void (*sighandler_t)(int);
sighandler_t signal(int signum, sighandler_t handler);
```
`signum`是信号名，`handler`是常量SIG_IGN、常量SIG_DEL或当接到此信号后要调用的函数的地址。如果指定SIG_IGN，则向内核表示忽略此信号。如果指定SIG_DEL，则表示接到此信号后的动作是系统默认动作。当指定函数地址时，则在信号发生时，调用该函数，我们称这种处理为**捕捉该信号**，成此函数为**信号处理函数**或**信号捕捉函数**。

## 不可靠的信号
不可靠指的是，信号可能会丢失；一个信号发生了，但是进程却可能一直不知道这一点。同时，进程对信号的控制能力也很差，它能捕捉信号或忽略信号。

## 中断的系统调用
如果进程在执行一个低速系统调用而阻塞期间捕捉到一个信号，则该系统调用就被中断不再继续执行。该系统调用返回出错，其`errno`设置为EINTR。
**系统调用**包括低速系统调用和其他系统调用。
低速系统调用是可能会使进程永远阻塞的一类系统调用。

**低速系统调用包括**：

+ 如果某些类型文件(如读管道、终端设备和网络设备)的数据不存在，则读操作可能会使调用者永远阻塞。
+ 如果这些数据不能被相同的类型文件立即接受，则写操作可能会使调用者永远阻塞。
+ 在某种条件发生之前打开某些类型文件，可能会发生阻塞。
+ `pause`函数和`wait`函数。
+ 某些ioctl操作。
+ 某些进程间通信函数。